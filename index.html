<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>Mini Oyunlar - Flappy Bird</title>
  <style>
    :root{
      --bg:#0b1220;
      --panel:#111a2e;
      --text:#e8eefc;
      --muted:#a8b3d6;
      --accent:#59d38b;
      --danger:#ff5c7a;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box; margin:0; padding:0;}
    body{
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background: radial-gradient(1200px 600px at 20% 0%, #1b2a55 0%, var(--bg) 50%, #070b14 100%);
      color:var(--text);
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:18px;
    }
    .app{
      width:min(1100px, 100%);
      display:grid;
      grid-template-columns: 320px 1fr;
      gap:16px;
    }
    @media (max-width: 900px){
      .app{ grid-template-columns: 1fr; }
    }
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border: 1px solid rgba(255,255,255,.08);
      border-radius:16px;
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .sidebar{ padding:16px; }
    .brand{
      display:flex; align-items:center; gap:10px;
      margin-bottom:14px;
    }
    .logo{
      width:42px; height:42px; border-radius:12px;
      background: linear-gradient(135deg, #4fd1c5, #59d38b);
      display:grid; place-items:center;
      color:#071013; font-weight:800;
      box-shadow: 0 10px 20px rgba(89,211,139,.25);
    }
    .brand h1{ font-size:18px; line-height:1.1; }
    .brand p{ font-size:12px; color:var(--muted); margin-top:4px; }
    .games{
      display:flex; flex-direction:column; gap:10px;
      margin-top:12px;
    }
    .gameBtn{
      text-align:left;
      width:100%;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(17,26,46,.45);
      color:var(--text);
      cursor:pointer;
      display:flex; align-items:center; justify-content:space-between;
      transition: transform .08s ease, background .2s ease, border-color .2s ease;
    }
    .gameBtn:hover{ transform: translateY(-1px); background: rgba(17,26,46,.70); border-color: rgba(255,255,255,.18);}
    .gameBtn.active{ outline:2px solid rgba(89,211,139,.55); border-color: rgba(89,211,139,.35); }
    .pill{
      font-size:11px; color:#071013;
      background: var(--accent);
      padding:4px 8px; border-radius:999px; font-weight:700;
    }
    .hint{
      margin-top:14px;
      padding:12px;
      border-radius:14px;
      background: rgba(0,0,0,.18);
      border:1px solid rgba(255,255,255,.08);
      color: var(--muted);
      font-size:13px;
      line-height:1.35;
    }
    .main{
      position:relative;
      padding:12px;
    }
    .topbar{
      display:flex; align-items:center; justify-content:space-between;
      padding:12px 12px 8px 12px;
    }
    .title{
      display:flex; flex-direction:column; gap:2px;
    }
    .title b{ font-size:16px; }
    .title span{ font-size:12px; color:var(--muted); }
    .actions{
      display:flex; gap:8px; flex-wrap:wrap;
    }
    .btn{
      border:1px solid rgba(255,255,255,.12);
      background: rgba(17,26,46,.55);
      color:var(--text);
      padding:9px 10px;
      border-radius:12px;
      cursor:pointer;
      font-weight:650;
      font-size:13px;
      transition: background .15s ease, transform .08s ease;
    }
    .btn:hover{ background: rgba(17,26,46,.75); transform: translateY(-1px); }
    .btn.primary{ background: rgba(89,211,139,.18); border-color: rgba(89,211,139,.30);}
    .btn.danger{ background: rgba(255,92,122,.14); border-color: rgba(255,92,122,.28);}

    /* Canvas container */
    .stage{
      margin: 0 12px 12px 12px;
      border-radius:16px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.10);
      background: #0b1327;
      position:relative;
      touch-action: manipulation;
      user-select:none;
    }
    canvas{ display:block; width:100%; height:auto; }

    .overlay{
      position:absolute; inset:0;
      display:flex; align-items:center; justify-content:center;
      background: linear-gradient(180deg, rgba(0,0,0,.35), rgba(0,0,0,.65));
      opacity:0; pointer-events:none;
      transition: opacity .2s ease;
    }
    .overlay.show{ opacity:1; pointer-events:auto; }
    .panel{
      width:min(420px, 92%);
      padding:18px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(17,26,46,.78);
      box-shadow: var(--shadow);
      text-align:center;
    }
    .panel h2{ font-size:18px; margin-bottom:6px;}
    .panel p{ font-size:13px; color:var(--muted); margin-bottom:12px; line-height:1.35;}
    .scoreBig{
      font-size:46px; font-weight:900;
      letter-spacing:1px;
      margin: 6px 0 10px;
      text-shadow: 0 10px 30px rgba(0,0,0,.4);
    }
    .smallRow{
      display:flex; gap:10px; justify-content:center; flex-wrap:wrap;
      margin-top:10px;
    }
    .chip{
      font-size:12px; color:var(--muted);
      padding:8px 10px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.20);
      min-width: 120px;
    }
    .footerNote{
      text-align:center;
      color: rgba(255,255,255,.35);
      font-size:11px;
      margin-top:8px;
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="card sidebar">
      <div class="brand">
        <div class="logo">üéÆ</div>
        <div>
          <h1>Mini Oyunlar</h1>
          <p>Se√ß ‚Üí Oyna ‚Üí Skor yap</p>
        </div>
      </div>

      <div class="games">
        <button class="gameBtn active" data-game="flappy">
          <div>
            <div style="font-weight:800">Flappy Bird</div>
            <div style="font-size:12px;color:var(--muted);margin-top:2px;">Orijinale √ßok benzer hissiyat</div>
          </div>
          <span class="pill">OK</span>
        </button>

        <button class="gameBtn" data-game="soon">
          <div>
            <div style="font-weight:800">Yakƒ±nda</div>
            <div style="font-size:12px;color:var(--muted);margin-top:2px;">Snake / Tetris / Runner‚Ä¶</div>
          </div>
          <span class="pill" style="background:#ffd36b;">SOON</span>
        </button>
      </div>

      <div class="hint">
        <b>Flappy Kontrolleri</b><br/>
        ‚Ä¢ <b>Space</b> / <b>Tƒ±klama</b> / <b>Dokunma</b> = zƒ±pla<br/>
        ‚Ä¢ <b>P</b> = duraklat<br/>
        ‚Ä¢ <b>R</b> = yeniden ba≈ülat<br/>
        <div style="margin-top:8px;opacity:.9">
          ƒ∞stersen sonraki adƒ±mda: oyun listesi + skor tablosu + mobil tam ekran + ses efektleri ekleyelim.
        </div>
      </div>
    </div>

    <div class="card main">
      <div class="topbar">
        <div class="title">
          <b id="gameTitle">Flappy Bird</b>
          <span id="gameSubtitle">Space / Dokun / Tƒ±kla ile zƒ±pla. Borulara √ßarpma.</span>
        </div>
        <div class="actions">
          <button class="btn primary" id="btnStart">Start</button>
          <button class="btn" id="btnPause">Pause</button>
          <button class="btn danger" id="btnRestart">Restart</button>
        </div>
      </div>

      <div class="stage" id="stage">
        <canvas id="c" width="900" height="520"></canvas>

        <div class="overlay show" id="overlay">
          <div class="panel">
            <h2 id="overlayTitle">Flappy Bird</h2>
            <p id="overlayText">Ba≈ülamak i√ßin <b>Start</b>‚Äôa bas veya ekrana dokun.</p>
            <div class="scoreBig" id="bigScore">0</div>
            <div class="smallRow">
              <div class="chip">Best: <b id="bestScore">0</b></div>
              <div class="chip">Mod: <b id="modeText">Classic</b></div>
              <div class="chip">Kontrol: <b>Tap/Space</b></div>
            </div>
            <div class="smallRow" style="margin-top:12px;">
              <button class="btn primary" id="btnOverlayStart">Start</button>
              <button class="btn" id="btnOverlayRestart">Restart</button>
            </div>
            <div class="footerNote">Bu s√ºr√ºm ‚Äúhissi‚Äù hedefler: yer√ßekimi, flap g√ºc√º, boru aralƒ±ƒüƒ±, hƒ±z.</div>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
(() => {
  // ---------- UI ----------
  const canvas = document.getElementById('c');
  const ctx = canvas.getContext('2d');
  const stage = document.getElementById('stage');

  const btnStart = document.getElementById('btnStart');
  const btnPause = document.getElementById('btnPause');
  const btnRestart = document.getElementById('btnRestart');

  const overlay = document.getElementById('overlay');
  const overlayTitle = document.getElementById('overlayTitle');
  const overlayText = document.getElementById('overlayText');
  const bigScore = document.getElementById('bigScore');
  const bestScoreEl = document.getElementById('bestScore');

  const btnOverlayStart = document.getElementById('btnOverlayStart');
  const btnOverlayRestart = document.getElementById('btnOverlayRestart');

  // Sidebar selection (future-proof)
  document.querySelectorAll('.gameBtn').forEach(b=>{
    b.addEventListener('click', () => {
      document.querySelectorAll('.gameBtn').forEach(x=>x.classList.remove('active'));
      b.classList.add('active');
      const g = b.dataset.game;
      if(g !== 'flappy'){
        alert('Bu oyun hen√ºz eklenmedi üôÇ (ƒ∞stersen sƒ±radaki oyunu birlikte se√ßelim.)');
        document.querySelector('[data-game="flappy"]').classList.add('active');
        b.classList.remove('active');
      }
    });
  });

  // ---------- HiDPI scaling ----------
  function fitCanvas() {
    // Keep aspect ratio similar to classic flappy.
    const maxW = stage.clientWidth;
    const targetW = Math.max(320, maxW);
    const targetH = Math.round(targetW * (520/900));
    canvas.style.width = targetW + 'px';
    canvas.style.height = targetH + 'px';

    const dpr = Math.max(1, Math.min(2.5, window.devicePixelRatio || 1));
    canvas.width = Math.round(targetW * dpr);
    canvas.height = Math.round(targetH * dpr);
    ctx.setTransform(dpr,0,0,dpr,0,0);
    // Note: we draw in CSS pixels (targetW/targetH)
    W = targetW; H = targetH;
  }

  let W = 900, H = 520;
  window.addEventListener('resize', fitCanvas, {passive:true});
  fitCanvas();

  // ---------- Game constants (tuned for "original feel") ----------
  const GRAV = 0.42;        // gravity
  const FLAP = -7.4;        // jump impulse
  const MAX_FALL = 10.5;
  const PIPE_SPEED = 2.65;  // scrolling speed
  const PIPE_GAP = 132;     // vertical gap
  const PIPE_W = 78;
  const PIPE_SPAWN = 155;   // distance between pipes
  const GROUND_H = 86;
  const BIRD_X = 0.28;      // relative x of bird

  // ---------- Persistent best score ----------
  const LS_KEY = 'mini_games_flappy_best';
  let best = Number(localStorage.getItem(LS_KEY) || '0');
  bestScoreEl.textContent = best;

  // ---------- Game state ----------
  let running = false;
  let paused = false;
  let gameOver = false;

  let score = 0;
  let frame = 0;

  const bird = {
    x: 0,
    y: 0,
    vy: 0,
    r: 14,
    rot: 0
  };

  let pipes = [];
  let lastPipeX = 0;

  // Background layers
  let clouds = [];
  function resetClouds(){
    clouds = [];
    for(let i=0;i<7;i++){
      clouds.push({
        x: Math.random()*W,
        y: 30 + Math.random()*(H-GROUND_H-180),
        s: 0.4 + Math.random()*0.9,
        sp: 0.35 + Math.random()*0.55
      });
    }
  }

  function resetGame() {
    running = false;
    paused = false;
    gameOver = false;
    score = 0;
    frame = 0;

    bird.x = Math.round(W * BIRD_X);
    bird.y = Math.round(H * 0.45);
    bird.vy = 0;
    bird.rot = 0;

    pipes = [];
    lastPipeX = W + 120;
    spawnPipe(lastPipeX);
    spawnPipe(lastPipeX + PIPE_SPAWN);
    spawnPipe(lastPipeX + PIPE_SPAWN*2);

    resetClouds();

    bigScore.textContent = score;
    overlayTitle.textContent = "Flappy Bird";
    overlayText.innerHTML = 'Ba≈ülamak i√ßin <b>Start</b>‚Äôa bas veya ekrana dokun.';
    showOverlay(true);
    render(); // draw one frame
  }

  function showOverlay(show) {
    overlay.classList.toggle('show', show);
  }

  function spawnPipe(x) {
    const minTop = 70;
    const maxTop = H - GROUND_H - PIPE_GAP - 110;
    const top = Math.floor(minTop + Math.random()*(maxTop-minTop));
    pipes.push({
      x,
      top,              // top pipe bottom edge
      passed:false
    });
    lastPipeX = x;
  }

  function flap() {
    if(!running){
      start();
      return;
    }
    if(gameOver) return;
    if(paused) return;
    bird.vy = FLAP;
  }

  function start() {
    if(gameOver) resetGame();
    running = true;
    paused = false;
    showOverlay(false);
  }

  function pauseToggle() {
    if(!running || gameOver) return;
    paused = !paused;
    if(paused){
      overlayTitle.textContent = "Duraklatƒ±ldƒ±";
      overlayText.innerHTML = 'Devam etmek i√ßin <b>Pause</b> (veya <b>P</b>) tekrar bas.';
      bigScore.textContent = score;
      showOverlay(true);
    }else{
      showOverlay(false);
    }
  }

  function end() {
    gameOver = true;
    running = false;
    paused = false;
    if(score > best){
      best = score;
      localStorage.setItem(LS_KEY, String(best));
      bestScoreEl.textContent = best;
    }
    overlayTitle.textContent = "Game Over";
    overlayText.innerHTML = 'Tekrar dene: <b>Restart</b> (veya <b>R</b>)';
    bigScore.textContent = score;
    showOverlay(true);
  }

  // ---------- Input ----------
  window.addEventListener('keydown', (e) => {
    if(e.code === 'Space'){ e.preventDefault(); flap(); }
    if(e.code === 'KeyP'){ pauseToggle(); }
    if(e.code === 'KeyR'){ resetGame(); start(); }
  }, {passive:false});

  // Click/tap on stage
  stage.addEventListener('pointerdown', (e) => {
    e.preventDefault();
    flap();
  }, {passive:false});

  btnStart.addEventListener('click', start);
  btnPause.addEventListener('click', pauseToggle);
  btnRestart.addEventListener('click', () => { resetGame(); start(); });

  btnOverlayStart.addEventListener('click', start);
  btnOverlayRestart.addEventListener('click', () => { resetGame(); start(); });

  // ---------- Collision helpers ----------
  function circleRectCollide(cx, cy, r, rx, ry, rw, rh){
    // nearest point
    const nx = Math.max(rx, Math.min(cx, rx+rw));
    const ny = Math.max(ry, Math.min(cy, ry+rh));
    const dx = cx - nx;
    const dy = cy - ny;
    return (dx*dx + dy*dy) <= r*r;
  }

  // ---------- Update ----------
  function update() {
    if(!running || paused || gameOver) return;

    frame++;

    // Clouds parallax
    for(const cl of clouds){
      cl.x -= cl.sp * 0.45;
      if(cl.x < -120) { cl.x = W + 140; cl.y = 30 + Math.random()*(H-GROUND_H-180); cl.s = 0.4 + Math.random()*0.9; }
    }

    // Bird physics
    bird.vy += GRAV;
    if(bird.vy > MAX_FALL) bird.vy = MAX_FALL;
    bird.y += bird.vy;

    // Rotation similar to original
    const targetRot = Math.max(-0.55, Math.min(1.25, bird.vy / 10));
    bird.rot += (targetRot - bird.rot) * 0.18;

    // Pipes movement
    for(const p of pipes){
      p.x -= PIPE_SPEED;
      // Score passing
      const pipeMid = p.x + PIPE_W;
      if(!p.passed && pipeMid < bird.x){
        p.passed = true;
        score++;
        bigScore.textContent = score;
      }
    }

    // Remove off-screen and spawn new
    while(pipes.length && pipes[0].x < -PIPE_W-20){
      pipes.shift();
    }
    const rightmost = pipes.reduce((m,p)=>Math.max(m,p.x), 0);
    if(rightmost < W + 120){
      spawnPipe(rightmost + PIPE_SPAWN);
    }

    // Ground collision
    const groundY = H - GROUND_H;
    if(bird.y + bird.r >= groundY){
      bird.y = groundY - bird.r;
      end();
      return;
    }
    // Ceiling collision (original: touch top => die)
    if(bird.y - bird.r <= 0){
      bird.y = bird.r;
      end();
      return;
    }

    // Pipe collisions
    for(const p of pipes){
      const gapTop = p.top;
      const gapBottom = p.top + PIPE_GAP;

      // top pipe rect
      const rx1 = p.x, ry1 = -1000, rw = PIPE_W, rh1 = 1000 + gapTop;
      // bottom pipe rect
      const rx2 = p.x, ry2 = gapBottom, rh2 = (H - GROUND_H) - gapBottom;

      // Slightly tighter than circle to mimic original hitbox feel
      const hitR = bird.r - 2;

      if(circleRectCollide(bird.x, bird.y, hitR, rx1, ry1, rw, rh1) ||
         circleRectCollide(bird.x, bird.y, hitR, rx2, ry2, rw, rh2)){
        end();
        return;
      }
    }
  }

  // ---------- Render ----------
  function drawSky() {
    // Sky gradient
    const grd = ctx.createLinearGradient(0,0,0,H);
    grd.addColorStop(0, '#66c7ff');
    grd.addColorStop(0.55, '#8fe0ff');
    grd.addColorStop(1, '#d9f7ff');
    ctx.fillStyle = grd;
    ctx.fillRect(0,0,W,H);

    // Sun
    ctx.beginPath();
    ctx.arc(W*0.80, H*0.20, 44, 0, Math.PI*2);
    ctx.fillStyle = 'rgba(255,245,180,.9)';
    ctx.fill();

    // Clouds
    for(const cl of clouds){
      const x = cl.x, y = cl.y, s = cl.s;
      ctx.fillStyle = 'rgba(255,255,255,.85)';
      cloud(x, y, 38*s);
      ctx.fillStyle = 'rgba(255,255,255,.65)';
      cloud(x+22*s, y+10*s, 28*s);
    }
    function cloud(x,y,r){
      ctx.beginPath();
      ctx.arc(x,y,r,0,Math.PI*2);
      ctx.arc(x+r*0.9,y+r*0.2,r*0.8,0,Math.PI*2);
      ctx.arc(x+r*1.7,y-r*0.1,r*0.95,0,Math.PI*2);
      ctx.arc(x+r*2.55,y+r*0.2,r*0.75,0,Math.PI*2);
      ctx.closePath();
    }

    // Far hills
    ctx.fillStyle = '#67d07a';
    ctx.beginPath();
    ctx.moveTo(0, H-GROUND_H-70);
    for(let i=0;i<=6;i++){
      const px = (W/6)*i;
      const py = (H-GROUND_H-70) + Math.sin(i*0.9 + frame*0.002)*18;
      ctx.lineTo(px, py);
    }
    ctx.lineTo(W, H-GROUND_H);
    ctx.lineTo(0, H-GROUND_H);
    ctx.closePath();
    ctx.fill();

    // Near hills
    ctx.fillStyle = '#4bbf68';
    ctx.beginPath();
    ctx.moveTo(0, H-GROUND_H-40);
    for(let i=0;i<=7;i++){
      const px = (W/7)*i;
      const py = (H-GROUND_H-40) + Math.sin(i*1.1 + frame*0.003)*12;
      ctx.lineTo(px, py);
    }
    ctx.lineTo(W, H-GROUND_H);
    ctx.lineTo(0, H-GROUND_H);
    ctx.closePath();
    ctx.fill();
  }

  function drawPipes() {
    const groundTop = H - GROUND_H;
    for(const p of pipes){
      const x = p.x;
      const gapTop = p.top;
      const gapBottom = p.top + PIPE_GAP;

      // Pipe body
      const bodyColor = '#3bd65c';
      const dark = '#23b34a';
      const edge = '#1b8d38';

      // Top pipe (extends up)
      drawPipe(x, gapTop, true);
      // Bottom pipe
      drawPipe(x, gapBottom, false);

      function drawPipe(x, y, isTop){
        // pipe body rect
        let ry, rh;
        if(isTop){
          ry = -900;
          rh = 900 + y;
        }else{
          ry = y;
          rh = (groundTop - y);
        }

        // Main body
        ctx.fillStyle = bodyColor;
        ctx.fillRect(x, ry, PIPE_W, rh);

        // inner shading
        ctx.fillStyle = dark;
        ctx.fillRect(x+8, ry, 10, rh);
        ctx.fillRect(x+PIPE_W-16, ry, 8, rh);

        // outline
        ctx.strokeStyle = edge;
        ctx.lineWidth = 3;
        ctx.strokeRect(x, ry, PIPE_W, rh);

        // Cap (lip)
        const capH = 18;
        const capW = PIPE_W + 10;
        const capX = x - 5;
        const capY = isTop ? (y - capH) : y;
        ctx.fillStyle = bodyColor;
        ctx.fillRect(capX, capY, capW, capH);
        ctx.strokeStyle = edge;
        ctx.strokeRect(capX, capY, capW, capH);

        // Cap highlight line
        ctx.strokeStyle = 'rgba(255,255,255,.25)';
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(capX+4, capY+3);
        ctx.lineTo(capX+capW-4, capY+3);
        ctx.stroke();
      }
    }
  }

  function drawGround() {
    const y = H - GROUND_H;
    // Ground
    ctx.fillStyle = '#e6d36a';
    ctx.fillRect(0, y, W, GROUND_H);

    // Top grass
    ctx.fillStyle = '#58d86d';
    ctx.fillRect(0, y, W, 14);

    // Dirt stripes moving (fake scroll)
    const stripeW = 26;
    const offset = (frame * PIPE_SPEED) % stripeW;
    ctx.fillStyle = 'rgba(0,0,0,.08)';
    for(let x = -offset; x < W + stripeW; x += stripeW){
      ctx.fillRect(x, y+18, stripeW/2, GROUND_H-18);
    }
  }

  function drawBird() {
    ctx.save();
    ctx.translate(bird.x, bird.y);
    ctx.rotate(bird.rot);

    // body
    ctx.fillStyle = '#ffd24a';
    ctx.beginPath();
    ctx.ellipse(0, 0, 16, 12, 0, 0, Math.PI*2);
    ctx.fill();

    // belly shade
    ctx.fillStyle = 'rgba(0,0,0,.08)';
    ctx.beginPath();
    ctx.ellipse(2, 3, 14, 9, 0, 0, Math.PI*2);
    ctx.fill();

    // wing
    ctx.fillStyle = '#f4b83b';
    ctx.beginPath();
    ctx.ellipse(-3, 2, 8, 6, 0.3, 0, Math.PI*2);
    ctx.fill();

    // beak
    ctx.fillStyle = '#ff8a3d';
    ctx.beginPath();
    ctx.moveTo(10, -1);
    ctx.lineTo(22, 2);
    ctx.lineTo(10, 6);
    ctx.closePath();
    ctx.fill();

    // eye
    ctx.fillStyle = '#ffffff';
    ctx.beginPath();
    ctx.arc(6, -4, 5, 0, Math.PI*2);
    ctx.fill();
    ctx.fillStyle = '#1c2230';
    ctx.beginPath();
    ctx.arc(7.5, -4, 2.2, 0, Math.PI*2);
    ctx.fill();

    // outline
    ctx.strokeStyle = 'rgba(0,0,0,.25)';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.ellipse(0, 0, 16, 12, 0, 0, Math.PI*2);
    ctx.stroke();

    ctx.restore();
  }

  function drawScore() {
    // big score at top center
    ctx.save();
    ctx.font = '900 44px system-ui, -apple-system, Segoe UI, Roboto, Arial';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'top';
    // shadow
    ctx.fillStyle = 'rgba(0,0,0,.35)';
    ctx.fillText(String(score), W/2 + 2, 14 + 3);
    ctx.fillStyle = '#ffffff';
    ctx.fillText(String(score), W/2, 14);
    ctx.restore();
  }

  function render() {
    ctx.clearRect(0,0,W,H);
    drawSky();
    drawPipes();
    drawGround();
    drawBird();
    drawScore();
  }

  // ---------- Main loop ----------
  function loop() {
    update();
    render();
    requestAnimationFrame(loop);
  }

  resetGame();
  loop();
})();
</script>
</body>
</html>
